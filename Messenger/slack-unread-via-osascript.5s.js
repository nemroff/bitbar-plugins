#!/usr/bin/env /usr/bin/osascript -l JavaScript
//
// {
//   'bitbar.title': "Slack Notification",
//   'bitbar.version': "v1.0",
//   'bitbar.author': "nemroff",
//   'bitbar.author.github': "nemroff",
//   'bitbar.desc': "Show number of unread Slack messages",
//   'bitbar.image': "https://i.imgur.com/I3MdNmU.png",
//   'bitbar.dependencies': "python,ruby,node",
//   'bitbar.abouturl': "http://url-to-about.com/",
// }
//
/// <reference path="../@jxa/global-type/src/index.d.ts" />
/// <reference path="../@jxa/types/src/index.d.ts" />

// To get the unread count from the dock status label: (requires accessibility features)
// Application('System Events').processes.byName("Dock").lists.at(0).uiElements.byName("Slack").attributes.byName('AXStatusLabel').value()

const slack = Application('Slack');

const images = {
  'bwTransparent': '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ZT4KICAgICAgICAgPGRjOmZvcm1hdD5hcHBsaWNhdGlvbi9wZGY8L2RjOmZvcm1hdD4KICAgICAgICAgPHhtcE1NOkRvY3VtZW50SUQ+dXVpZDo0NDRlZDJmNi0xODY0LTI2NDQtOThlMy03ZDljNzQxMzdmY2I8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpJbnN0YW5jZUlEPnV1aWQ6MWYyZmNhZjEtY2FjOS1mMDRmLTgzZDQtNTlhMzI3OTA0YmEzPC94bXBNTTpJbnN0YW5jZUlEPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIAo8P3hwYWNrZXQgZW5kPSJ3Ij8+DWVuZHN0cmVhbQ1lbmRvYmoNMiAwIG9iag08PC9GaWx0ZXIvRmxhdGVEZWNvZGUvRmlyc3QgNC9MZW5ndGggNDgvTiAxL1R5cGUvT2JqU3RtPj5zdHJlYW0NCmjeMlUwULCx0XfOL80rUTDU985MKY62BIoFxeqHVBak6gckpqcW29kBBBgA1ncLgA1lbmRzdHJlYW0NZW5kb2JqDTMgMCBvYmoNPDwvRmlsdGVyL0ZsYXRlRGVjb2RlL0ZpcnN0IDQvTGVuZ3RoIDYxL04gMS9UeXBlL09ialN0bT4+c3RyZWFtDQpo3jJTMFCwsdF3LkpNLMnMz3NJLEnVcLEyMjC0NLA0NDM0NAUiXQNzdQMDdU193/wUvArs7AACDAApZBMADWVuZHN0cmVhbQ1lbmRvYmoNNCAwIG9iag08PC9EZWNvZGVQYXJtczw8L0NvbHVtbnMgMy9QcmVkaWN0b3IgMTI+Pi9GaWx0ZXIvRmxhdGVEZWNvZGUvSURbPDg2REUzM0ZBQjg3MTQwNTZBMjI5QjU3QkQzM0RBNTk3Pjw5MTU1NjFFMDEzOTA0NTc3OEM1M0FFNTREMUVENjgzMj5dL0luZm8gNiAwIFIvTGVuZ3RoIDM3L1Jvb3QgOCAwIFIvU2l6ZSA3L1R5cGUvWFJlZi9XWzEgMiAwXT4+c3RyZWFtDQpo3mJiYGBgYmS/wMTA84OJgbGbiYFhBhPjG3EgzQgQYAA2hQQUDWVuZHN0cmVhbQ1lbmRvYmoNc3RhcnR4cmVmDTExNg0lJUVPRg0=',
  'bwSolid': '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ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzAxNiA5MS4xNjM2MTYsIDIwMTgvMTAvMjktMTY6NTg6NDkgICAgICAgICI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgICAgICAgICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyI+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDE5LTA5LTE2VDExOjUwOjU5LTA3OjAwPC94bXA6TW9kaWZ5RGF0ZT4KICAgICAgICAgPHhtcDpDcmVhdGVEYXRlPjIwMTktMDktMTZUMTE6NTA6NTktMDc6MDA8L3htcDpDcmVhdGVEYXRlPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDE5LTA5LTE2VDExOjUwOjU5LTA3OjAwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8ZGM6Zm9ybWF0PmFwcGxpY2F0aW9uL3BkZjwvZGM6Zm9ybWF0PgogICAgICAgICA8eG1wTU06RG9jdW1lbnRJRD51dWlkOjEwZDMwYzQ1LTkwOWUtZWY0Yi04NWY3LTIyYzQ4YWI2YzUwZjwveG1wTU06RG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkluc3RhbmNlSUQ+dXVpZDowZGQxOWU1My1iZDFiLWY1NGUtYjIwNS1hZGE4ZGYxMjM4ZjQ8L3htcE1NOkluc3RhbmNlSUQ+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgCjw/eHBhY2tldCBlbmQ9InciPz4NZW5kc3RyZWFtDWVuZG9iag0yIDAgb2JqDTw8L0ZpbHRlci9GbGF0ZURlY29kZS9GaXJzdCA0L0xlbmd0aCA0OC9OIDEvVHlwZS9PYmpTdG0+PnN0cmVhbQ0KaN4yVTBQsLHRd84vzStRMNT3zkwpjrYEigXF6odUFqTqBySmpxbb2QEEGADWdwuADWVuZHN0cmVhbQ1lbmRvYmoNMyAwIG9iag08PC9GaWx0ZXIvRmxhdGVEZWNvZGUvRmlyc3QgNC9MZW5ndGggNjIvTiAxL1R5cGUvT2JqU3RtPj5zdHJlYW0NCmjeMlMwULCx0XcuSk0syczPc0ksSdVwsTIyMLQ0sDQ0MzQ0NTC11DUwVzcwUNfU981PwavAzg4gwAAq6RMODWVuZHN0cmVhbQ1lbmRvYmoNNCAwIG9iag08PC9EZWNvZGVQYXJtczw8L0NvbHVtbnMgMy9QcmVkaWN0b3IgMTI+Pi9GaWx0ZXIvRmxhdGVEZWNvZGUvSURbPEMyMzMwQzZBNkQzNjRDNkI4RkQ0MkZCOTZGNjZBQ0Y3PjwyQTQ2ODg5QTI0MEM0N0M0ODhDQzI3MDVCRTU5NkQ3QT5dL0luZm8gNiAwIFIvTGVuZ3RoIDM3L1Jvb3QgOCAwIFIvU2l6ZSA3L1R5cGUvWFJlZi9XWzEgMiAwXT4+c3RyZWFtDQpo3mJiYGBgYmSby8TA84OJgbGbiYFhJhPjW08gzQgQYAAzSQQUDWVuZHN0cmVhbQ1lbmRvYmoNc3RhcnR4cmVmDTExNg0lJUVPRg0=',
  'color': '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aW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzAxNiA5MS4xNjM2MTYsIDIwMTgvMTAvMjktMTY6NTg6NDkgICAgICAgICI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgICAgICAgICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyI+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDE5LTA5LTE2VDExOjUwOjQyLTA3OjAwPC94bXA6TW9kaWZ5RGF0ZT4KICAgICAgICAgPHhtcDpDcmVhdGVEYXRlPjIwMTktMDktMTZUMTE6NTA6NDItMDc6MDA8L3htcDpDcmVhdGVEYXRlPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDE5LTA5LTE2VDExOjUwOjQyLTA3OjAwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8ZGM6Zm9ybWF0PmFwcGxpY2F0aW9uL3BkZjwvZGM6Zm9ybWF0PgogICAgICAgICA8eG1wTU06RG9jdW1lbnRJRD51dWlkOjFiMWQ5NGM5LWU0MTctNDQ0Yi1iOWE0LTg0ODJmMzY4MGYxMTwveG1wTU06RG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkluc3RhbmNlSUQ+dXVpZDowY2IxN2YyOS05NDU1LTU5NDQtYmRlOS03YTI3ZDYzNWI0MjM8L3htcE1NOkluc3RhbmNlSUQ+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgCjw/eHBhY2tldCBlbmQ9InciPz4NZW5kc3RyZWFtDWVuZG9iag0yIDAgb2JqDTw8L0ZpbHRlci9GbGF0ZURlY29kZS9GaXJzdCA0L0xlbmd0aCA0OC9OIDEvVHlwZS9PYmpTdG0+PnN0cmVhbQ0KaN4yVTBQsLHRd84vzStRMNT3zkwpjrYEigXF6odUFqTqBySmpxbb2QEEGADWdwuADWVuZHN0cmVhbQ1lbmRvYmoNMyAwIG9iag08PC9GaWx0ZXIvRmxhdGVEZWNvZGUvRmlyc3QgNC9MZW5ndGggNjIvTiAxL1R5cGUvT2JqU3RtPj5zdHJlYW0NCmjeMlMwULCx0XcuSk0syczPc0ksSdVwsTIyMLQ0sDQ0MzQ0NTAx0jUwVzcwUNfU981PwavAzg4gwAApLxL+DWVuZHN0cmVhbQ1lbmRvYmoNNCAwIG9iag08PC9EZWNvZGVQYXJtczw8L0NvbHVtbnMgMy9QcmVkaWN0b3IgMTI+Pi9GaWx0ZXIvRmxhdGVEZWNvZGUvSURbPEJGNDNCNDJCQzQyRTQzOEU5QkRCREQ3NjE1QUI1MkIyPjwyQkY0MTg4NDIzRjk0RUE1OEQ3OUM0NUREOUY4RTQ0Mj5dL0luZm8gNiAwIFIvTGVuZ3RoIDM3L1Jvb3QgOCAwIFIvU2l6ZSA3L1R5cGUvWFJlZi9XWzEgMiAwXT4+c3RyZWFtDQpo3mJiYGBgYmQ7yMTA84OJgbGbiYFhJhPjW1UgzQgQYAA1iQQUDWVuZHN0cmVhbQ1lbmRvYmoNc3RhcnR4cmVmDTExNg0lJUVPRg0=',
}


// var name = Application('Slack').windows.name()
// var re = /^Slack \| (?<conversation>[^\|]+) \| (?<workspace>[^\|]+)(?: \| (?<unread>\d+) new items?)?$/gi

// var results = re.exec(name)

// results.groups


// /Users/snemroff/Library/Application Support/Slack/storage/slack-teams

function updateMenuBar() {

  const log = function() {
    ObjC.import('Foundation');
    for (let argument of arguments) {
        $.NSFileHandle.fileHandleWithStandardOutput.writeData($.NSString.alloc.initWithString(String(argument) + "\n").dataUsingEncoding($.NSNEXTSTEPStringEncoding));
    }
  }

  const config = {
    'mode': Application('System Events').appearancePreferences.darkMode() ? 'dark' : 'light',
    'command': 'href=slack://open',
  }

  const icon = {
    'dark': {
      'none': `templateImage=${images.bwTransparent}`,
      'notify': `templateImage=${images.bwSolid}`,
      // 'notify': `templateImage=${images.color}`,
    },
    'light': {
      'none': `templateImage=${images.bwSolid}`,
      'notify': `image=${images.color}`,
    },
  }

  const re = / (\d+) new items?/gi

  const name = slack.windows.name()
  const result = re.exec(name)
  const unread_count = Array.isArray(result) ? result[1] : ''

  log([
    `${unread_count} | ${icon[config.mode][unread_count ? 'notify' : 'none']}`,
    '---',
    `${String(name).replace(/\|/g,':')} | ${config.command}`

    ].join('\n'))

}

if (slack.running()) updateMenuBar();